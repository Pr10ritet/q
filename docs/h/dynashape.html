<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Nodeny - Динамическое управление скоростями</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel='stylesheet' href='../i/nody.css' type='text/css'>
</head>
<body>
<div class='mainbody'>
<table border=0 width=90% class="coment"><tr>
<td><a href="../index.html"><img src="../i/logo.gif" border=0 valign=middle></a></td>
<td align=center><b>Биллинговая система NoDeny. Модуль динамического управления скоростями.</b></td>
</tr></table>
<br>

В настоящее время довольно типична ситуация, когда провайдер в силу ряда причин вынужден
продавать абонентам трафик с скоростями, которые зачастую перекрывают его общий канал.
При этом, особо активные абоненты, которые обычно составляют маленький процент от общего
количества, могут вызвать серьезные проблемы, постоянно загружая канал - торрентами либо
осуществляя посредничество между провайдером и иными абонентами. Не трогая юридическую сторону,
предлагается вариант обезопасить себя от чрезмерной активности абонентов.<br>
<br>

Суть заключается в постепенном понижении скорости доступа пропорционально потребленному трафику и/или изменения этой скорости в зависимости от времени суток. Такой механизм работает не глобально, а только для тех тарифных планов, в которых вы его активируете.<br>
<br>

Управление скоростями задается в виде таблицы: трафик &rarr; скорость. При превышении границы трафика,
указанной в таблице, абоненту устанавливается скорость соответствующая границе.<br>
<br>

<div class='code'><div class='mark'>Пример начальных условий</div>
<pre>
Трафик, Мб	Скорость, кбит/сек
  1000		  480
  2000		  400
  3000		  360
  5000		  300
 10000		  256
</pre>
</div>
В данном примере клиент получит скорость указанную в тарифе, только если использует менее 1 Гб трафика.
При трафике от 1 до 2 Гб - 480 кбит/сек, 2..3 Гб - 400 кбит/сек и т.д. В момент, когда у 
клиента, скажем, 3333 Мб, скорость будет установлена в 360 кбит/сек. При превышении 10Гб
скорость установится в 256 кбит/сек и дальше не будет уменьшаться.<br>
<br>

Как вы могли заметить, можно получить нелинейную зависимость трафик &rarr; скорость.<br>
<br>
Чтобы активировать режим динамического управления скоростями, необходимо в тарифе поставить галку
напротив аналогичного пункта, а в поле "скрипты" вписать строку, описывающую таблицу скоростей
в виде:<br>
<br>


<div class='code'>
<b>0:трафик-скорость:трафик-скорость:трафик-скорость</b><br>
</div>

<br>
Здесь 0 - указание, что строка скрипта является таблицей скоростей. Трафик указывать исключительно
в порядке его возрастания! Нулевая скорость недопустима. Пробелы недопустимы. Нулевой трафик допустим.<br>
<br>

<div class='code'><div class='mark'>Скрипт, соответствующий примеру выше</div>
<b>0:1000-480:2000-400:3000-360:5000-300:10000-256</b><br>
</div>

Управление скоростями можно задействовать не только для тарифов, в которых указана скорость
(например, безлимитные), но и обычных. Обратите внимание на нюанс:<br>
<br>
В NoDeny предусмотрено, что, если у тарифа указана скорость, то все алиасные записи, попадают
в одну "трубу", т.е суммарно будут иметь скорость не большую чем указано в пакете тарификации.
Для иных тарифов не применяется такая схема, т.е, для каждой записи устанавливается своя скорость,
прописанная в настройках сателлита либо персональная скорость, прописанная в настройках учетной записи.<br>
<br>

При использовании модуля управления скоростями, если пакет в пакете тарификации не указана скорость,
то до достижении первой границы скорости будет применяться стандартная схема - у каждой записи
своя скорость как описано выше. В противном случае включается механизм как для анлимитных пакетов -
все алиасные записи суммарно будут иметь скорость, указанную в таблице.<br>
<br>
<br>
Управление скоростями в зависимости от времени стуток имеет такой формат:<br>
<br>

<div class='code'>
<b>&lt;time h,h,h&gt;0:трафик-скорость:трафик-скорость:трафик-скорость</b><br>
</div>

где h - час суток, в которые будет активна данная строка скрипта.<br>
<br>

<div class='code'><div class='mark'>Пример скрипта</div>
<pre>
&lt;time 0,1,2,3,4&gt;0:0-10000
&lt;time 18,19,20&gt;0:20000-512:50000-256:100000-128
&lt;time 21&gt;0:20000-400:50000-300
0:0-1024
</pre>
</div>

Расшифровка:<br>
<br>
с 0:00 до 4:59  ночи каждый абонент тарифа получит 10000 кбит скорости вне зависимости от трафика.<br>
<br>
с 18:00 до 20:59 - скорость указанную в тарифе, но при превышении 20 Гб скорость будет установлена в 512 кбит, 50 Гб - 256 кбит, 100 гб - 128 кбит.<br>
<br>
С 21:00 до 21:59 будет работать правило: скорость тарифа, но при превышении 20Гб - 400 кбит, 50гб -300 кбит.<br>
<br>
Во все остальное время клиентам будет выдана скорость 1024 кбит вне зависимости от трафика.<br>
<br>

Есле убрать строку `0:0-1024`, то во все остальное (не описанное в скрипте) время, динамическое управление скоростями
будет отключаться, т.е. учетная запись будет работать по параметрам скоростей, заданным в тарифе.<br>
<br>
<br>
<br>

Динамический шейпер в качестве трафика может рассматривать не только месячный, но и суточный трафик.
В этом случае в строке описания необходимо первый ноль заменить на единицу:<br>
<br>

<div class='code'>
<b>1:трафик-скорость:трафик-скорость:трафик-скорость</b><br>
</div>

<br>
<br>
<br>


<div class='code'><div class='mark'>Внимание</div>
<b>Использование динамического управления скоростями разрешается только в целях ознакомпления. После чего вы должны
либо отказаться от его использования либо приобрести лицензию на использование этой возможности у авторов NoDeny.</b>
</div>

<br>
<br>
<br>
<br>
<br>
</body>
</html>
