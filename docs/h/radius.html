<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Nodeny - Настройка Radius</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel='stylesheet' href='../i/nody.css' type='text/css'>
</head>
<body>
<div class='mainbody'>
<table border=0 width=90% class="coment"><tr>
<td><a href="../index.html"><img src="../i/logo.gif" border=0 valign=middle></a></td>
<td align=center><b>Биллинговая система NoDeny. Настройка Radius.</b></td>
</tr>
</table>

<div class='mainbody'>
<br>
В данном разделе описывается первоначальная настройка radius без привязки к NoDeny.
Предназначена для того, чтобы вы установили и проверили работоспособность этого пакета,
после чего настроили в связке с <a href='mikrotik_radius.html'>mikrotik</a> или
<a href='mpd5.html'>mpd</a>.
Тем не менее для тестирование необходимо существование БД NoDeny.<br>
<br>


<div class="code"><div class="mark">команда bash</div>
cd /usr/ports/net/freeradius && make install clean
</div>

<div class="code"><div class="mark">ваши действия</div>
ставим галку напротив MYSQL
</div>

<div class="code"><div class="mark">команды bash</div>
cd /usr/local/etc/raddb/<br>
ee radiusd.conf
</div>

<div class="code"><div class="mark">редактирование файла radiusd.conf</div>
Файл состоит из нескольких секций:

<div class="mess">
<pre>
название секции {
   данные
}</pre>
</div>

Вы должны последовательно в секциях:
<ul>
<li>authorize</li>
<li>accounting</li>
<li>session</li>
</ul>
расскоментировать строку: sql
</div>


<div class="code"><div class="mark">команда bash</div>
ee clients.conf
</div>

<div class="code"><div class="mark">редактирование файла clients.conf</div>

<div class="mess">
<pre>
client 127.0.0.1 {
  ...
  ...
}</pre>
</div>

меняем на:

<div class="mess">
<pre>
client 127.0.0.1 {
        secret      = hardpass5
        shortname   = NoDenyDB
        nastype     = cisco
}</pre>
</div>

- этим создали radius-клиента, который будет
иметь доступ к radius-у по паролю hardpass5.
</div>


<div class="code"><div class="mark">команда bash</div>
ee sql.conf
</div>

<div class="code"><div class="mark">редактирование файла sql.conf</div>

в cекции sql смотрим чтоб присутствовала строка:

<div class="mess">driver = "rlm_sql_mysql"</div>

<br>
Меняем параметры:

<div class="mess">
<pre>
 server = "localhost"
 login = "bill_kernel"
 password = "hardpass4"
 radius_db = "bill"
</pre>
</div>

<br>
Далее находим:

<div class="mess"><pre>
 authorize_check_query = ".....
     ....."
</pre>
</div>

и меняем на

<div class="mess">authorize_check_query = "SELECT NULL, 'test', 'Password', '123456', '=='"</div>

<br>
Удаляем:

<div class="mess"><pre>
 authorize_reply_query = ".....
     ....."
</pre>
</div>

</div>


<div class="code"><div class="mark">команда bash</div>
ee users
</div>

<div class="code"><div class="mark">редактирование файла users</div>
Комментируем строки:

<div class="mess">DEFAULT Auth-Type = System</div>
<div class="mess">Framed-IP-Address = 255.255.255.254,</div>
<div class="mess">Framed-MTU = 576,</div>
<div class="mess">Framed-Compression = Van-Jacobson-TCP-IP</div>

</div>


<div class="code"><div class="mark">команды bash</div>
/usr/local/etc/rc.d/radiusd forcestart<br>
sockstat | grep radius
</div>

<div class="code"><div class="mark">видим на экране</div>
<pre>
root     radiusd    977   3  udp4   *:1812                *:*
root     radiusd    977   4  udp4   *:1813                *:*
</pre>
</div>

<br>
Проверяем работоспособность radius:

<div class="code"><div class="mark">команда bash</div>
radtest test 123456 127.0.0.1 0 hardpass5
</div>

<div class="code"><div class="mark">видим на экране</div>
<pre>
Sending Access-Request of id 216 to 10.0.0.1 port 1812
        User-Name = "test"
        User-Password = "123457"
        NAS-IP-Address = 255.255.255.255
        NAS-Port = 0
rad_recv: Access-Accept packet from host 127.0.0.1:1812, id=83, length=20
</pre>
</div>

Ответ radius содержится в строке `rad_recv:`. Если ответ принят, а также в нем
присутствует `Access-Accept` - все впорядке, тестирование заканчиваем. В противном случае
запускаем radius в debug-режиме:<br>
<br>
<div class="code"><div class="mark">команды bash</div>
/usr/local/etc/rc.d/radiusd forcestop<br>
/usr/local/sbin/radiusd -X
</div>

При этом весь процесс авторизации будет выводиться на экран.

</div>
<br><br><br><br>
<br><br><br><br>
<br><br><br><br>
<br><br><br><br>
<br>
<br>
<br>
<br></body>
</html>
