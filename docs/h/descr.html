<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Nodeny - Install</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel='stylesheet' href='../i/nody.css' type='text/css'>
</head>
<body>
<div class='mainbody'>
<table border=0 width=90% class="coment"><tr>
<td><a href="../index.html"><img src="../i/logo.gif" border=0 valign=middle></a></td>
<td align=center><b>Биллинговая система NoDeny. Детали системы</b></td>
</tr></table>
<br><br><br>


<ul>
<li><a href="#strct">Структурная схема NoDeny</a></li>
<li><a href="#prkt">Проектирование системы</a></li>
</ul>
<br>
<br>
<a name="strct">Структурная схема NoDeny:</a><br>
<br>
<img src="../i/p24.gif"><br>
<br><br>
Центральный узел всей системы - база данных. Взаимодействие всех составляющих системы между собой в большинстве
случаев идет через БД, поэтому БД - это наиболее требовательная часть и по надежности и по производительности.<br>
<br>
NoDeny модульная система, позволяет разнести узлы на различные, возможно географически удаленные, сервера.
Пример построения сети обслуживающей 2 района:<br>
<br>
<img src="../i/s2.gif"><br>
<br>
<br>
На схеме 2 сателлита:  обслуживающий клиентов района 1 и клиентов района 2. Между
сателлитами и шлюзом в интернет установлены сервера с контентом. Благодаря такой схеме получаем
контролируемый доступ клиентов и в интернет и к локальным ресурсам сети. Более того, если
сегментировать сеть vlan-ами, то появляется дополнительная возможность управлять трафиком
и между абонентами сети, т.е. разрешать/блокировать, шейпить и считать этот трафик.<br>
<br>

В простейшем случае все компоненты NoDeny устанавливаются на один сервер:<br>
<br>
<img src="../i/s3.gif"><br>
<br>
<br>
Вынос компоненты в отдельный сервер диктуется как географическими размерами сети так и размерами абонентской базы.
Логичнее производить управление доступом и авторизацию как можно ближе к клиенту, т.е.
в каждом районе организовать свой сателлит обслуживания.<br>
<br>


Примеры.<br>
<br>
1) Разделение на 2 сервера:<br>
<br>
Сервер 1: ядро NoDeny, базы данных, веб-администрирование, клиентская статистика.<br>
Сервер 2: шлюз, коллектор, агенты авторизации и доступа.<br>
<br>


2) Разделение на 3 сервера:<br>
<br>
Сервер 1: ядро NoDeny, базы данных.<br>
Сервер 2: шлюз, коллектор, агент авторизации и доступа.<br>
Сервер 3: веб-администрирование, клиентская статистика, резервный агент авторизации.<br>
<br>

<br>
<br>
<br>
<b>База данных разделена на три составляющие:</b><br>
<br>
1) основная база данных хранит ключевую информацию: список абонентов, платежи, архивы, таблицы топологии, оборудования и др;<br>
2) дополнительная база содержит расширенную статистику трафика, возможно с детализацией до ip, порта и протокола;<br>
3) база авторизации содержит таблицу-очередь авторизаций.<br>
<br>
Разделение баз данных на различные сервера может понадобиться в случае регистрации полной детализации трафика при большом
количестве абонентов (десятки тысяч).<br>
<br>

За основу принята СУБД Mysql.<br>
<br>
<br>




<b>Назначение модулей</b><br>
<br>
Агенты авторизации предназначены для идентификации клиентов, для гарантии, что в сети с текущими параметрами (например ip-адрес)
присутствует легальный абонент. Клиенты авторизации периодически записывают в очередь авторизаций информацию о том, кто и как
авторизовался.<br>
<br>

Можно применять различные виды авторизаций, при этом комбинировать их. L2-авторизация - один из методов авторизации,
разработанный конкретно под систему NoDeny. Предусматривает авторизацию с помощью специальной программы-авторизатора.
Преимуществом этой авторизации является: минимальные требования к служебному трафику, поддержка ненадежных каналов
(с большим процентом потерь, радиолинки и т.д), надежное шифрование, удобное отображение данных для клиента.<br>
<br>

Ядро NoDeny периодически опрашивает коллекторы, снимающие показания о потреблении услуг клиентом (например, трафике),
обновляет данные клиента в базе данных, на основании полученных данных из очереди авторизации и других условий
(например, баланса клиента) разрешает/запрещает клиенту интернет/доступ к услугам и т.д.<br>
<br>

Веб-статистика клиентов предназначена для получения более расширенной информации о состоянии счета клиента, его трафике,
истории и т.д.<br>
<br>

Веб-администрирование предназначено для администраторов различных уровней и позволяет управлять данными клиентов и системой
в целом.<br>
<br>

<br>
<br>
<br>
<br>



<div class="coment" align=center><a name="prkt">Проектирование системы</a></div><br>
<br>

Опыт автора говорит о том, что возможность масштабирования это одно из самых важных свойств, поскольку
все показатели (география сети, количество абонентов, трафик) обычно неуклонно растут опережая все ожидания.
Для ознакомления с системой вы можете настроить все на одном PC, однако &#171;в боевых условиях&#187; желательно
разделить вычислительную часть (ядро, базы данных) и часть управления (управление доступом, авторизацию,
коллекторы трафика) на разные сервера. Так при росте сети как географически так и абонентской базы, вы сможете
беспроблемно внедрить новый элемент либо разделить имеющийся.<br>
<br>

Статистически, автор определил (сам и по данным иных администраторов), что на данный момент, PC-роутер под управлением
FreeBSD 6.x (7.x), использующий управление скоростями трафика (шейпами) для каждого абонента, а также ведущий
сбор статистики, &#171;переваривает&#187; от 1000 до 1500 абонентов. Кроме количества клиентов, большое значение имеет
величина потока трафика, а также количество маршрутизируемых пакетов в единицу времени. Скажем, для сети в
1500 абонентов с 10% анлимитчиков, активно использующих торрент, т.е формирующих наибольшее количество потоков,
с средним количеством авторизованных клиентов до 35% в единицу времени, формируется трафик примерно 0,5 Гбита
с количеством пакетов до 100 тыс/сек. Это означает, что маршрутизатор должен &#171;переваривать&#187; трафик не менее 1Гбит
при 200 тыс пакетов в секунду. Обычно, используя более-менее серверное оборудование, например сетевые
карты <em>em</em>, удается получить в 1,5-2 раза большие результаты.<br>
<br>
Использование шейпов, в случае их оптимизированной схемы, в частности продуманного использования таблиц фаервола ipfw,
снижает производительность обычно незначительно.<br>
<br>

Бюджетное решение &#171;все в одном&#187; (ядро, БД, коллектор, авторизация и управление доступом на одном сервере-шлюзе)
справится с 1000 абонентов, однако автор рекомендует подумать о разделении NoDeny на составляющие при подходе к
цифре 600-800 абонентов. Для начала в отдельный сервер следует выделить ядро с базой данных, остальные составляющие
оставить на шлюзе.<br>
<br> 
<br>

<a href='install.html#start'>Установка системы NoDeny</a>

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
</body>
</html>
